**نقاط رئيسية**  
- التطبيق الحالي (أفان تيتر / mo7rer) قاعدة قوية جداً: محرر ويب مبني على React 19 + Tiptap/ProseMirror مع تصنيف ذكي لعناصر السيناريو، دعم RTL عربي كامل، استيراد Fountain/FDX، وتخطيط A4 احترافي.  
- معظم المتطلبات قابلة للتنفيذ بكفاءة عالية باستخدام مكتبات مفتوحة المصدر تتناسب مع الـ stack الحالي، خاصة التعاون اللحظي، التعليقات، والـ AI.  
- الفرصة السوقية كبيرة في الدعم العربي الكامل + أدوات الإنتاج المدمجة (Stripboard، Budgeting، AI Story Analysis)، حيث لا يوجد منافس عربي احترافي حالياً.  
- خطة التطوير المقترحة: مرحلة أولى (3-6 أشهر) للتعاون والـ Offline + AI الأساسي، ثم أدوات الإنتاج، ثم الموبايل/لينكس.  
- نموذج Freemium + B2B واقعي ومربح: خطة مجانية محدودة بالـ AI calls والتعاون، وحزم استوديوهات تشمل تحليل سيناريو مدفوع.  

**الوضع الحالي للتطبيق**  
أفان تيتر هو محرر سيناريو ويب عربي متقدم يعمل في المتصفح، يدعم التصنيف التلقائي متعدد الطبقات (Regex + سياق + AI اختياري عبر Claude)، انتقال ذكي بـ Enter/Tab، تخطيط صفحات A4 حقيقي، واستيراد PDF/DOCX/TXT/Fountain/FDX مع تصنيف فوري. الواجهة RTL كاملة، والكود منظم (TypeScript strict، Tailwind، Radix UI). لا يدعم حالياً التعاون اللحظي، الـ Offline المتقدم، أو أدوات الإنتاج.  

**أولويات التطوير الموصى بها**  
1. التعاون اللحظي + التعليقات + تاريخ المراجعات (أعلى تأثير على المستخدمين).  
2. Offline Mode + مزامنة سحابية موثوقة.  
3. دعم Fountain/FDX كامل ثنائي الاتجاه + Auto-format دقيق.  
4. أدوات التخطيط (Scene Navigator، Beat Board، Index Cards).  
5. AI Writing Assistant + Story Analysis (مخصص للسيناريو).  
6. أدوات ما قبل الإنتاج + Story Bible.  
7. تطبيقات موبايل + دعم لينكس رسمي.  

**التقنيات الموصى بها (تتناسب مع React + Tiptap)**  
- **تعاون لحظي**: Tiptap Collaboration + Yjs (CRDTs) + Hocuspocus backend.  
- **تعليقات داخلية**: Tiptap Comments extension أو tiptap-comment-extension المجتمعي.  
- **Offline**: PWA (Vite plugin) + IndexedDB (idb أو Dexie) + Yjs للـ sync.  
- **سحابي**: Supabase (Realtime + Auth + Storage) أو Firebase.  
- **Fountain**: fountain-js أو screenplay-tools.  
- **FDX**: fast-xml-parser + screenplay-parser.  
- **AI**: API لـ Grok/OpenAI/Claude مع prompts مخصصة + LangChain للـ agents (Plot Hole Detector، Rewrite، إلخ).  
- **موبايل**: 10tap-editor (مبني على Tiptap لـ React Native) أو Capacitor/Tauri.  
- **لينكس**: Tauri أو Electron.  
- **خرائط العلاقات + Timeline**: React Flow + vis-timeline.  
- **Stripboard/Budget**: بناء مخصص بـ @dnd-kit + جداول sortable (بديل مفتوح لـ Movie Magic).  

---

**دليل شامل لتطوير أفان تيتر: تحقيق كل المتطلبات المطلوبة**  

**1. التعاون اللحظي وأدوات المراجعة**  
الـ Real-time Collaboration يُنفذ بسهولة تامة باستخدام امتداد Tiptap الرسمي Collaboration مع مكتبة Yjs (CRDTs) التي تتعامل مع التعارضات تلقائياً وتدعم العمل بدون إنترنت جزئياً. يُضاف Hocuspocus (backend مفتوح من ueberdosis) أو y-websocket للخادم. يأتي معه cursors حية، presence، وتعليقات inline.  

لـ In-line Comments: استخدم Tiptap Comments extension (يسمح بتعليقات threaded على نصوص أو nodes) أو النسخة المجتمعية tiptap-comment-extension التي تعمل كـ marks مع node views.  

Revision History + Revision Tracking + Colors: Yjs يحفظ snapshots تلقائياً، ويمكن إضافة تلوين التغييرات عبر awareness أو مقارنة diffs بسيطة (مثل Git). يُعرض تاريخ المراجعات في sidebar مع إمكانية الرجوع لأي نسخة.  

**2. Offline Mode + مزامنة سحابية**  
حوّل التطبيق إلى PWA باستخدام Vite PWA plugin + Service Workers للتخزين المؤقت. استخدم IndexedDB (مكتبة idb أو Dexie) لحفظ المستندات محلياً مع auto-save موجود بالفعل. عند الاتصال، يتم المزامنة عبر Yjs updates أو Supabase Realtime. هذا يضمن عمل كامل بدون إنترنت ومزامنة موثوقة للمشاريع.  

**3. دعم Fountain و FDX كامل**  
الاستيراد موجود جزئياً، لكن للتصدير الكامل:  
- Fountain: استخدم fountain-js (يدعم كل الصيغ حتى v1.1) للـ parse والـ export إلى HTML/PDF.  
- FDX: fast-xml-parser لتحليل الـ XML، مع mapping إلى نموذج ScreenplayBlock الداخلي (مكتبات مثل screenplay-tools أو screenplay-parser تدعم التحويل).  

يمكن إضافة زر "Export as .fountain" أو ".fdx" في ثوانٍ.  

**4. أدوات التنقل والتخطيط المتقدمة**  
- Scene Navigator: قائمة جانبية مع tree view للمشاهد (Tiptap يوفر node views للـ scene heads).  
- Index Cards + Scene Cards + Beat Board: استخدم React DnD أو @dnd-kit مع cards قابلة للسحب، مرتبطة بالمستند عبر IDs.  
- Script Notes + Alternate Dialogue: امتدادات Tiptap مخصصة (custom nodes) تظهر كـ side notes أو popups.  

**5. التنسيق الاحترافي + SmartType + عربي كامل**  
Auto-format موجود جزئياً، يُعزز بقواعد Tiptap commands. SmartType: autocomplete سياقي باستخدام Trie بسيط للمصطلحات الشائعة + AI suggestions عبر API.  

RTL: Tiptap يدعم dir="rtl" و textDirection extension رسمياً (auto detection للنصوص المختلطة). الخط AzarMehrMonospaced موجود بالفعل، يُوسع لكل الـ UI.  

**6. دعم لينكس + تطبيقات موبايل**  
- لينكس: حوّل إلى Tauri (خفيف، native) أو Electron لتوزيع .deb/AppImage.  
- موبايل (iOS/Android): 10tap-editor (مبني على Tiptap/ProseMirror لـ React Native) للمحرر، أو Capacitor لتحويل الـ web app. يحتفظ بالـ extensions الحالية.  

**7. أدوات ما قبل الإنتاج**  
- Stripboard (Scheduling): جدول sortable مع drag-drop للمشاهد + حساب eighths وأيام التصوير (يمكن بناؤه بـ React Table + @dnd-kit؛ لا يوجد open-source كامل لكن StudioBinder/Celtx يعملان بنفس الطريقة).  
- Budgeting + Breakdown Sheets + Shot Lists: استخراج العناصر من المستند (locations، characters، props) → جداول + قوالب Excel export.  
- Storyboarding: تكامل مع canvas أو مكتبة storyboarder.  
- Media Library: Supabase Storage لرفع صور/فيديو مرتبطة بالمشروع.  
- Production Reports: تقارير PDF مولدة بـ jsPDF أو server-side.  

**8. Story Bible + أدوات القصة**  
Character Arc Builder + Story Timeline + World Building + Relationship Map: تبويبات منفصلة.  
- Relationship Map: React Flow (nodes = شخصيات، edges = علاقات).  
- Timeline: vis-timeline أو react-chrono.  
- Logline/Synopsis Generator: AI prompt مخصص.  

**9. AI Writing Assistant المتكامل**  
استخدم API calls (Grok/OpenAI/Claude) داخل sidebar conversational mode.  
- Dialogue Generator / Character Voice AI / Plot Twist: prompts محددة مع سياق المستند.  
- Plot Hole Detector / Structure Suggestions: تحليل كامل للنص + اقتراحات.  
- Rewrite / Shrink / Expand / Describe (sensory): commands تُرسل جزءاً من النص + تعليمات.  
- AI Story Bible / Character AI Coach / Brainstorm Mode: agents منفصلة بـ LangChain.  

يُفعّل في الخطة المدفوعة فقط (حد calls في Freemium).  

**10. نموذج الأعمال**  
- Freemium: مجاني (محرر أساسي + استيراد/تصدير محدود + AI بسيط).  
- Pro: تعاون غير محدود + AI كامل + أدوات إنتاج.  
- B2B: حزم للاستوديوهات (on-prem، API، تحليل سيناريو مدفوع قبل التصوير).  
استخدم Stripe للاشتراكات + Supabase للـ user management.  

**جدول مقترح لخارطة الطريق (Roadmap)**  

| المرحلة | المدة التقريبية | الميزات الرئيسية | التقنيات الرئيسية | الأولوية |
|---------|------------------|-------------------|---------------------|-----------|
| 1: الأساس | 2-3 أشهر | Real-time Collab + Comments + Revision + Offline | Tiptap+Yjs, PWA, IndexedDB | عالية |
| 2: التنسيق والتخطيط | 2 أشهر | Full Fountain/FDX + Navigator + Beat Board + Cards | fountain-js, React DnD | عالية |
| 3: AI متقدم | 2-3 أشهر | Writing Assistant كامل + Plot Hole + Rewrite | Grok/Claude API + LangChain | عالية |
| 4: الإنتاج | 3 أشهر | Stripboard + Budget + Breakdown + Story Bible | React Flow, custom tables | متوسطة |
| 5: المنصات | 2 أشهر | Mobile (iOS/Android) + Linux Desktop | 10tap / Tauri | متوسطة |
| 6: الأعمال | مستمر | Freemium + B2B + Reports | Stripe + Supabase | منخفضة |

**خطوات التنفيذ العملية الأولى**  
1. أضف Tiptap Collaboration + Yjs في editor.ts.  
2. أنشئ backend بسيط بـ Hocuspocus أو Supabase Edge Functions.  
3. حوّل إلى PWA وأضف IndexedDB sync.  
4. اختبر AI prompts مخصصة للسيناريو العربي.  
5. أطلق نسخة beta مع Freemium لجمع feedback من كتاب السيناريو في مصر والخليج.  
